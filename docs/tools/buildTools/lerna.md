---
title: ğŸ—ï¸ Lerna Monorepo ç®¡ç†å·¥å…·å®Œå…¨æŒ‡å—
description: Lerna å¤šåŒ…ç®¡ç†å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼ŒåŒ…æ‹¬é¡¹ç›®åˆå§‹åŒ–ã€ä¾èµ–ç®¡ç†ã€ç‰ˆæœ¬æ§åˆ¶ã€å‘å¸ƒæµç¨‹ç­‰æœ€ä½³å®è·µ
outline: deep
---

# ğŸ—ï¸ Lerna Monorepo ç®¡ç†å·¥å…·å®Œå…¨æŒ‡å—

> Lerna æ˜¯ä¸€ä¸ªå¿«é€Ÿã€é¢†å…ˆçš„æ„å»ºç³»ç»Ÿï¼Œç”¨äºç®¡ç†å’Œå‘å¸ƒæ¥è‡ªåŒä¸€æºç ä»“åº“ï¼ˆMonoreposï¼‰çš„å¤šä¸ª JavaScript/TypeScript è½¯ä»¶åŒ…ã€‚

## ğŸ¯ Lerna ç®€ä»‹

Lerna æ˜¯ä¸€ä¸ªå¿«é€Ÿã€é¢†å…ˆçš„æ„å»ºç³»ç»Ÿï¼Œç”¨äºç®¡ç†å’Œå‘å¸ƒæ¥è‡ªåŒä¸€æºç ä»“åº“ï¼ˆMonoreposï¼‰çš„å¤šä¸ª JavaScript/TypeScript è½¯ä»¶åŒ…ã€‚

### âœ¨ æ ¸å¿ƒä¼˜åŠ¿

Lerna è§£å†³äº† JavaScript/TypeScript å•ä¸€æºç ä»“åº“ï¼ˆmonoreposï¼‰çš„ä¸¤å¤§é—®é¢˜ï¼š

| åŠŸèƒ½ | æè¿° | ä¼˜åŠ¿ |
|------|------|------|
| **é«˜æ•ˆæ‰§è¡Œ** | é’ˆå¯¹ä»»æ„æ•°é‡çš„é¡¹ç›®è¿è¡Œå‘½ä»¤ | âš¡ ä»¥æœ€é«˜æ•ˆçš„æ–¹å¼ã€æ­£ç¡®çš„é¡ºåºè¿è¡Œ |
| **å‘å¸ƒç®¡ç†** | ç®¡ç†ä»ç‰ˆæœ¬æ§åˆ¶åˆ° NPM å‘å¸ƒçš„å®Œæ•´æµç¨‹ | ğŸš€ æ”¯æŒå¤šç§å·¥ä½œæµç¨‹ |
| **ä»»åŠ¡è°ƒåº¦** | åŸºäº Nx ä»»åŠ¡è¿è¡Œç¨‹åº | ğŸ”„ å…è´¹è·å¾—ç¼“å­˜å’Œåˆ†å¸ƒå¼è¿è¡Œ |

::: info ğŸ“– ç‰ˆæœ¬ç‰¹æ€§
ä» v6+ ç‰ˆæœ¬å¼€å§‹ï¼ŒLerna å°†ä»»åŠ¡è°ƒåº¦å·¥ä½œå§”æ‰˜ç»™ç»è¿‡å®æˆ˜æ£€éªŒã€ä¸šç•Œé¢†å…ˆçš„ Nx ä»»åŠ¡è¿è¡Œç¨‹åºï¼Œè¿™æ„å‘³ç€ `lerna run` å¯ä»¥å…è´¹è·å¾—ç¼“å­˜å’Œå‘½ä»¤åˆ†å¸ƒå¼è¿è¡Œæ‰€å¸¦æ¥çš„å¥½å¤„ï¼

**å‚è€ƒæ–‡æ¡£**: [Lerna å®˜æ–¹æ–‡æ¡£](https://www.lernajs.cn/docs/getting-started)
:::

### ğŸ—ï¸ é¡¹ç›®ç»“æ„

æ–°ç‰ˆæœ¬çš„ Lerna ç»Ÿä¸€æ”¹ä¸ºä½¿ç”¨åŒ…ç®¡ç†å™¨ï¼ˆå¦‚ï¼šnpm/yarn/pnpmï¼‰æ¥ç®¡ç†ä¾èµ–ã€‚

Lerna ä»“åº“æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š`packages` ç›®å½•ä¸ºå­é¡¹ç›®å‚¨å­˜ç›®å½•

```txt
my-lerna-repo/
  package.json
  packages/
    package-1/
      package.json
    package-2/
      package.json
```

## Lerna ä½¿ç”¨

```bash
# å…¨å±€å®‰è£…lerna
npm install lerna -g

# åˆ›å»ºä¸€ä¸ªç©ºç›®å½•
mkdir ./lerna-demo
# è¿›å…¥åˆ°æ–°åˆ›å»ºçš„ç›®å½•
cd ./lerna-demo

# åˆå§‹åŒ– lerna æ–°çš„æºç ä»“åº“ï¼ˆä½¿ç”¨ --dryRun å‚æ•°æ¥é¢„è§ˆæ›´æ”¹ï¼‰
npx lerna init --dryRun


# åœ¨å·²æœ‰çš„æºç ä»“åº“ä¸­åˆå§‹åŒ– lerna æ—¶ï¼Œå®ƒéœ€è¦çŸ¥é“åº”è¯¥åœ¨å“ªäº›è½¯ä»¶åŒ…ä¸Šè¿è¡Œ
# --packages å‚æ•°ï¼Œæ‰‹åŠ¨æŒ‡å®šä¸€ç»„åŒ¹é…æ¨¡å¼æ¥æŒ‡å®šéœ€è¦ç®¡ç†çš„è½¯ä»¶åŒ…ï¼š
# æŒ‡å®šä¸€ä¸ªåŒ¹é…æ¨¡å¼ï¼šinitåç”Ÿæˆä¸€ä¸ªå¯æ­£å¸¸ä½¿ç”¨çš„ git ä»“åº“ï¼ŒåŒ…æ‹¬ npm workspaces åŠŸèƒ½
npx lerna init --packages="packages/*"
# æŒ‡å®šå¤šä¸ªåŒ¹é…æ¨¡å¼
npx lerna init --packages="foo/*" --packages="bar/*"

# åœ¨packagesç›®å½•ä¸‹åˆ›å»ºchildå­é¡¹ç›®ï¼Œpackage nameæœ€å¥½åŠ ä¸ŠèŒƒå›´ï¼Œç±»ä¼¼@vue/cli
lerna create child

# ä½¿ç”¨listå‘½ä»¤å¯ä»¥æŸ¥çœ‹è¢«lernaç®¡ç†çš„å­é¡¹ç›®
lerna list
lerna ls

# v7ç‰ˆæœ¬ä¹‹å‰ï¼Œæ˜¯å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¯ä»¥ä¸ºé¡¹ç›®å®‰è£…ä¾èµ–ã€‚
lerna add lodash

# ä¹‹åç‰ˆæœ¬ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£… -w ç»™æŸä¸ªå­é¡¹ç›®å®‰è£…ä¾èµ–
# v8ç‰ˆæœ¬åï¼Œæ‰€æœ‰ä¾èµ–éƒ½æ”¾åœ¨æœ€å¤–å±‚ï¼Œé¿å…node_modulesçš„å·¨å‹ä½“ç§¯é—®é¢˜
npm install lodash -w packages/child
# å­é¡¹ç›®ä¸­ç›¸äº’ä¾èµ–çš„åŒ…ï¼šå­é¡¹ç›®utilä¾èµ–å­é¡¹ç›®child
npm install @lerna-demo/child -w packages/util

# æ¸…ç©ºæ‰€æœ‰é¡¹ç›®çš„ä¾èµ–
lerna clear
# æ¸…ç©ºchildå’Œutilçš„ä¾èµ–
lerna clean --scope @lerna-demo/child --scope @lerna-demo/util

# execæ‰§è¡Œç»ˆç«¯å‘½ä»¤ï¼šä¸Šä¸‹æ–‡æ­£æ˜¯packagesç›®å½•ä¸‹ç®¡ç†çš„å­é¡¹ç›®ï¼Œå¹¶éæ˜¯æ ¹ç›®å½•ã€‚
# æŸ¥çœ‹coreå’Œutilæ‰€æœ‰æ–‡ä»¶ï¼Œ
lerna exec ls
# æŸ¥çœ‹æŸå­é¡¹ç›®ï¼š
lerna exec --scope [pkgName] -- [stream]

# æ‰§è¡Œnpm script :æ‰§è¡Œæ‰€æœ‰å­é¡¹ç›®devå‘½ä»¤
lerna run dev
# æ‰§è¡Œchildå­é¡¹ç›®çš„buildå‘½ä»¤
lerna run build --scope @lerna-demo/child


# æŸ¥çœ‹ç‰ˆæœ¬å·®å¼‚ï¼šå‰ææ˜¯éœ€è¦æœ‰commitè®°å½•
lerna diff

# æ›´æ–°é¡¹ç›®ç‰ˆæœ¬å·
lerna version

# publishå‘½ä»¤ä¼šå°†é¡¹ç›®å‘å¸ƒåˆ°npmä¸­ï¼šè‡ªå®šæ‰§è¡Œlerna version å¹¶æ‰“ä¸€ä¸ªtag
lerna publish

# æ‰“å°æœ¬åœ°ç¯å¢ƒçš„è°ƒè¯•ä¿¡æ¯
lerna info
# ç”Ÿæˆä»»åŠ¡è¿è¡Œå™¨é…ç½®çš„äº¤äº’å¼æç¤ºç¬¦
lerna add-caching
# åˆ—å‡ºè‡ªä¸Šä¸€ä¸ªå¸¦æ ‡ç­¾çš„ç‰ˆæœ¬ä»¥æ¥å·²æ›´æ”¹çš„æœ¬åœ°åŒ…
lerna changed
# è¿è¡Œè‡ªåŠ¨è¿ç§»ä»¥ä¿®å¤çŸ¥è¯†åº“çš„çŠ¶æ€
lerna repair
# æ¯å½“åŒ…æˆ–å…¶ä¾èµ–é¡¹æ›´æ”¹æ—¶ï¼Œè¿è¡Œå‘½ä»¤
lerna watch
# å°†åŒ…å¯¼å…¥åˆ°å¸¦æœ‰æäº¤å†å²è®°å½•çš„monorepoä¸­
lerna import
```

ä»¥èŒƒå›´çš„æ–¹å¼å‘å¸ƒåŒ…ï¼Œéœ€è¦æå‰å»ºç«‹å¥½ç»„ç»‡
![alt text](image-16.png)
